@inherits Umbraco.Web.Mvc.UmbracoViewPage<UmbracoSecondDemo.Controllers.CartItemsViewModel>
@using ContentModels = Umbraco.Web.PublishedContentModels;
@{
    Layout = "Master.cshtml";
}
@Html.Partial("~/Views/Partials/SectionHeader.cshtml")

<link href="~/Content/toastr.css" rel="stylesheet" />
<script src="~/Scripts/toastr.js"></script>
<section class="section">
    <button class="button button--border--solid" onclick='resetCartClick()'>Reset cart items</button>
    
    <div class="container">
        <table border="1">
            <caption>Items in cart:</caption>
                <tr>
                    <th>Product Name</th>
                    <th>Product Count</th>
                </tr>
                
            @foreach (KeyValuePair<string,int> productData in Model.Items)
            {
                <tr>
                    <td>@productData.Key</td>
                    <td>@productData.Value</td>
                    <td><button class="button button--border--solid" onclick='removeCartItemClick("@productData.Key")'>Remove 1 Instance</button></td>
                </tr>
            }
        </table>
        Total sum:
    </div>

</section>


<script type="text/javascript">
    function resetCartClick() {
        $.post("/umbraco/surface/CartEditor/ResetCartItems",
            function (response) {
                toastr.options = {
                    "closeButton": false,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": false,
                    "positionClass": "toast-top-center",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "300",
                    "hideDuration": "1000",
                    "timeOut": "5000",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                }
                toastr.success("You removed all items from the cart!");
            });
    };

    function removeCartItemClick(itemIdentifier) {
        $.post(
            "/umbraco/surface/CartEditor/RemoveItem",
            {
                itemId: itemIdentifier
            },
            function (response) {
                toastr.options = {
                    "closeButton": false,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": false,
                    "positionClass": "toast-top-center",
                    "preventDuplicates": false,
                    "onclick": function () { window.location = window.location},
                    "showDuration": "300",
                    "hideDuration": "1000",
                    "timeOut": "5000",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                }
                toastr.success("One instance of Item was removed from the Cart!");
            });
    };
</script>